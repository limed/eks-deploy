#!/bin/bash

set -e

MY_DIR="$(dirname "$0")"
. "${MY_DIR}/utils.sh"

ENVIRONMENT=$1
AWS_REGION="${AWS_REGION:-us-west-2}"

if [ -z "${BASEDIR}" ]; then die "BASEDIR must be set"; fi

if [ -z "${ENVIRONMENT}" ]; then
    echo "Pulls EKS kubeconfig"
    echo "Usage: $0 <environment: stage|prod>"
    exit 1
fi

ENVIRONMENT_FILE="${DEPLOY_FOLDER}/${ENVIRONMENT}.yaml"
K8S_CLUSTER=$(get_cluster_name "${ENVIRONMENT_FILE}") || die "K8S_CLUSTER is not set"

print_ok "Our environment is: ${ENVIRONMENT}"
print_ok "Grabbing kubeconfig for cluster ${K8S_CLUSTER}"

get_kubeconfig "${K8S_CLUSTER}"
